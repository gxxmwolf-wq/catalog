<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <title>RXDE ‚Äî –õ–µ–∫–∞—Ä—Å—Ç–≤–∞ –∏–∑ –ì–µ—Ä–º–∞–Ω–∏–∏. –†–µ–µ—Å—Ç—Ä v100.54</title>
    <meta name="description" content="–ü–æ–∏—Å–∫ –∏ –∑–∞–∫–∞–∑ –ª–µ–∫–∞—Ä—Å—Ç–≤ –∏–∑ –∞–ø—Ç–µ–∫ –ú—é–Ω—Ö–µ–Ω–∞. –ê–∫—Ç—É–∞–ª—å–Ω—ã–π —Ä–µ–µ—Å—Ç—Ä, —Ü–µ–Ω—ã –≤ —Ä—É–±–ª—è—Ö –∏ –µ–≤—Ä–æ. –î–æ—Å—Ç–∞–≤–∫–∞ –≤ –†–§ 12-25 –¥–Ω–µ–π. –í–∏—Ç–∞–º–∏–Ω—ã, —Ä–µ–¥–∫–∏–µ –ø—Ä–µ–ø–∞—Ä–∞—Ç—ã, –±–µ–∑ —Ä–µ—Ü–µ–ø—Ç–∞.">
    <meta name="keywords" content="–ª–µ–∫–∞—Ä—Å—Ç–≤–∞ –∏–∑ –≥–µ—Ä–º–∞–Ω–∏–∏, –∞–ø—Ç–µ–∫–∞ –º—é–Ω—Ö–µ–Ω, –≤–∏—Ç–∞–º–∏–Ω—ã –∏–∑ –µ–≤—Ä–æ–ø—ã, –¥–æ—Å—Ç–∞–≤–∫–∞ –ª–µ–∫–∞—Ä—Å—Ç–≤, ospolot, —Å—É–ª—å—Ç–∏–∞–º, –∑–∞–∫–∞–∑ –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç–æ–≤">

    <link rel="icon" type="image/png" sizes="32x32" href="favicon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="favicon.png">
    <link rel="apple-touch-icon" href="favicon.png">
    <meta name="theme-color" content="#005691">

    <meta property="og:type" content="website">
    <meta property="og:url" content="https://rxde.online/">
    <meta property="og:title" content="üá©üá™ RXDE ‚Äî –ê–ø—Ç–µ–∫–∞ –ú—é–Ω—Ö–µ–Ω–∞">
    <meta property="og:description" content="–†–µ–µ—Å—Ç—Ä –ª–µ–∫–∞—Ä—Å—Ç–≤ —Å —Ü–µ–Ω–∞–º–∏. –ü—Ä—è–º–æ–π –∑–∞–∫–∞–∑, –¥–æ—Å—Ç–∞–≤–∫–∞ –≤ –†–§. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ!">
    <meta property="og:image" content="https://rxde.online/favicon.png">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        :root { --p: #005691; --bg: #f4f6f8; --w: #fff; --txt: #333; --gr: #666; --accent: #e3f2fd; --rx: #d32f2f; --otc: #2e7d32; --active: #4caf50; --old: #f57f17; --info-bg: #e1f5fe; --info-txt: #0277bd; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--bg); color: var(--txt); margin: 0; padding-bottom: 120px; -webkit-tap-highlight-color: transparent; }
        .cont { max-width: 600px; margin: 0 auto; padding: 10px; }
        
        header { background: var(--w); padding: 12px 15px; border-radius: 12px; margin-bottom: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        
        .head-top { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 6px; flex-wrap: wrap; gap: 10px; }
        
        h1 { margin: 0; font-size: 0.9rem; color: var(--p); text-transform: uppercase; font-weight: 800; display: flex; align-items: center; gap: 6px; }
        .version-badge { font-size: 0.6rem; padding: 2px 6px; border-radius: 4px; font-weight: normal; text-transform: none; letter-spacing: 0.5px; border: 1px solid transparent; }
        .version-badge.local { background: #e3f2fd; color: #1565c0; border-color: #90caf9; } 
        .version-badge.global { background: #e8f5e9; color: #2e7d32; border-color: #c8e6c9; }

        .top-date { font-size: 0.75rem; color: #888; font-weight: 500; }

        .info-msg { background: var(--info-bg); color: var(--info-txt); font-size: 0.7rem; padding: 8px 10px; border-radius: 8px; margin-bottom: 8px; line-height: 1.35; border: 1px solid #b3e5fc; }

        .trust-line { background: #fff; padding: 6px 10px; border-radius: 8px; font-size: 0.7rem; border: 1px solid #e0e6ed; color: #555; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 5px; }

        #errorBox { display: none; background: #ffebee; color: #c62828; border: 1px solid #e57373; padding: 15px; border-radius: 10px; margin-bottom: 15px; font-size: 0.85rem; line-height: 1.4; word-break: break-word; }

        .sticky { position: sticky; top: 0; background: var(--bg); padding: 5px 0; z-index: 90; }
        .inp-wrap { position: relative; height: 50px; background: #fff; border-radius: 10px; border: 1px solid #ccc; overflow: hidden; display: flex; align-items: center; }
        
      /* 1. –ü–æ–ª–µ –≤–≤–æ–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ù–ê–í–ï–†–•, —á—Ç–æ–±—ã –∫—É—Ä—Å–æ—Ä –∏ —Ç–µ–∫—Å—Ç –±—ã–ª–∏ —á–µ—Ç–∫–∏–º–∏ */
        .search-input { 
            width: 100%; 
            padding: 10px 15px; 
            border-radius: 10px; 
            font-size: 16px; 
            box-sizing: border-box; 
            border: none; 
            outline: none; 
            font-family: inherit; 
            position: absolute; 
            top: 0; 
            left: 0; 
            height: 100%; 
            background: transparent; /* –ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å –ø—Ä–∏–∑—Ä–∞–∫–∞ */
            line-height: 1.5; 
            z-index: 2; /* –ì–õ–ê–í–ù–´–ô –°–õ–û–ô */
            color: #000; 
        }
        
        /* 2. –ü—Ä–∏–∑—Ä–∞–∫ —É—Ö–æ–¥–∏—Ç –ù–ê–ó–ê–î */
        #ghostInput { 
            position: absolute; 
            left: 0; 
            top: 0; 
            width: 100%; 
            height: 100%; 
            color: #bbb; 
            z-index: 1; /* –§–û–ù–û–í–´–ô –°–õ–û–ô */
            white-space: pre; 
            display: none; 
            align-items: center; 
            padding-left: 15px; 
            font-size: 16px; 
            font-family: inherit; 
        }
        #ghostInput.visible { display: flex; }
        
        /* 3. –ö–Ω–æ–ø–∫–∞-–ø–æ–¥—Å–∫–∞–∑–∫–∞: –õ–ï–ñ–ò–¢ –ü–û–í–ï–†–• –í–°–ï–ì–û */
        /* –£–ú–ù–ê–Ø –ö–ù–û–ü–ö–ê-–ü–û–î–°–ö–ê–ó–ö–ê */
        /* –£–ú–ù–ê–Ø –ö–ù–û–ü–ö–ê (–°—Ç–∏–ª—å "–¢9") */
        .hint-text { 
            position: absolute;
            right: 45px; 
            top: 10px; 
            z-index: 20; 
            
            display: none;
            align-items: center;
            height: 30px;
            
            background: #e8f5e9; 
            border: 1px solid #c8e6c9; 
            border-radius: 6px;
            padding: 0 10px;
            
            color: #2e7d32; 
            font-family: inherit; /* –®—Ä–∏—Ñ—Ç –∫–∞–∫ —É –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–∞–π—Ç–∞ */
            font-weight: 700;     /* –ñ–∏—Ä–Ω—ã–π */
            font-size: 0.85rem; 
            
            cursor: pointer; 
            pointer-events: auto; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            white-space: nowrap;
            max-width: 50%;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        /* –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–µ–ª–æ—á–∫—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–¥ —Å–ª–æ–≤–æ–º */
        .hint-text::before {
            content: "‚ûî ";
            opacity: 0.5;
            margin-right: 4px;
            font-weight: 400;
        }
        
        .hint-text.show { display: flex; }
        
        /* –ñ–∏—Ä–Ω–∞—è —á–∞—Å—Ç—å (—Ç–æ, —á—Ç–æ –¥–æ–±–∞–≤–∏—Ç—Å—è) */
        .hint-text .bold { 
            font-weight: 900; 
            text-decoration: none; /* –£–±—Ä–∞–ª–∏ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ */
            font-size: 1em; /* –ù–æ—Ä–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä */
        }
        
        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: —É–±–µ–¥–∏–º—Å—è, —á—Ç–æ –∫—Ä–µ—Å—Ç–∏–∫ (X) —Ç–æ–∂–µ –¥–æ—Å—Ç—É–ø–µ–Ω */
        .cls-btn { z-index: 11; }

        .cls-btn { position: absolute; right: 12px; top: 14px; color: #999; cursor: pointer; z-index: 3; font-size: 1.2rem; }
        
        .filter-tags { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 8px; min-height: 5px; }
        .chip { background: var(--active); color: #fff; padding: 4px 10px; border-radius: 15px; font-size: 0.7rem; display: flex; align-items: center; font-weight: 600; }
        .chip b { margin-left: 6px; cursor: pointer; font-size: 1rem; }
        
        .cat-nav-wrap { margin-top: 8px; display: flex; flex-direction: column; gap: 6px; }
        #catChips, #subCatChips { display: flex; gap: 8px; overflow-x: auto; scrollbar-width: none; -ms-overflow-style: none; padding: 2px 0; }
        #catChips::-webkit-scrollbar, #subCatChips::-webkit-scrollbar { display: none; }
        
        .cat-btn { padding: 6px 14px; border-radius: 20px; background: #fff; color: #333; font-size: 0.75rem; cursor: pointer; white-space: nowrap; box-shadow: 0 1px 2px rgba(0,0,0,0.1); border: 1px solid transparent; transition: 0.2s; font-weight: 500; }
        .cat-btn.active { background: #333; color: #fff; }
        .cat-btn.free-filter.active { background: var(--otc); color: #fff; border-color: var(--otc); }
        
        .sub-cat-btn { padding: 5px 12px; border-radius: 12px; background: #fff; color: var(--p); font-size: 0.7rem; cursor: pointer; white-space: nowrap; border: 1px solid var(--p); transition: all 0.2s ease; font-weight: 500; }
        .sub-cat-btn.active { background: var(--p); color: #fff; }

        .man-bar { display: none; justify-content: space-between; align-items: center; background: #fff8e1; padding: 8px 12px; border-radius: 8px; margin: 10px 0; font-size: 0.8rem; color: #f57f17; border: 1px solid #ffe082; }

        .empty-state { background: #fff; border-radius: 15px; padding: 30px 20px; text-align: center; border: 1px dashed #ccc; margin-top: 20px; }
        .empty-state h3 { color: var(--p); margin-top: 0; font-size: 1.1rem; }
        .empty-state p { font-size: 0.85rem; color: #666; line-height: 1.4; margin-bottom: 20px; }
        
        .did-you-mean { background: #e3f2fd; color: var(--p); padding: 12px; border-radius: 8px; margin-bottom: 20px; font-weight: bold; cursor: pointer; border: 1px solid #bbdefb; display: block; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .did-you-mean:hover { background: #bbdefb; }

        .empty-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .eb-btn { padding: 12px; border-radius: 10px; border: none; font-weight: bold; color: #fff; cursor: pointer; font-size: 0.8rem; }

        .card { background: var(--w); border-radius: 12px; padding: 10px 12px; margin-bottom: 6px; box-shadow: 0 1px 2px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: flex-start; transition: background 0.3s; border: 1px solid transparent; }
        .card.selected-item { background: #e3f2fd; border: 1px solid #bbdefb; }
        .c-tit-line { font-weight: 700; font-size: 0.95rem; color: #000; line-height: 1.35; display: inline; } 
        
        .badge { font-size: 0.6rem; padding: 1px 3px; border-radius: 4px; font-weight: 900; text-transform: uppercase; border: 1px solid; display: inline-block; vertical-align: middle; margin: 0 2px; position: relative; top: -1px; }
        .badge.rx { color: var(--rx); border-color: var(--rx); background: #fff1f1; }
        .badge.free { color: var(--otc); border-color: var(--otc); background: #f1fff1; }

        .check-btn { font-size: 0.6rem; text-decoration: none; background: #f0f0f0; color: #555; padding: 1px 5px; border-radius: 4px; border: 1px solid #ccc; display: inline-flex; align-items: center; gap: 3px; font-weight: 500; transition: 0.2s; white-space: nowrap; vertical-align: middle; margin-left: 2px; position: relative; top: -1px; }
        .check-btn:hover { background: #e0e0e0; color: #000; }

        .cam-wrap { position: relative; display: inline-block; cursor: pointer; color: var(--p); font-size: 1rem; }
        .preview-img { display: none; position: absolute; bottom: 25px; left: 0; z-index: 150; border: 3px solid var(--p); border-radius: 12px; background: #fff; width: 220px; box-shadow: 0 15px 40px rgba(0,0,0,0.3); }
        .cam-wrap:hover .preview-img { display: block; }

        .t-lnk { color: var(--p); cursor: pointer; border-bottom: 1px dashed #bbb; font-size: 0.7rem; padding: 0 3px; transition: 0.2s; white-space: nowrap; margin-bottom: 2px; display: inline-block; }
        .t-lnk.active-f { background: var(--active); color: #fff; border-bottom: none; border-radius: 4px; }

        .qty-wrap { display: flex; align-items: center; gap: 8px; margin-top: 6px; justify-content: flex-end; }
        .btn-qty { width: 30px; height: 30px; border-radius: 50%; border: 1px solid #ddd; background: #fff; color: var(--p); font-size: 1.2rem; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .btn-qty.add { background: var(--p); color: #fff; border-color: var(--p); }

        .cart-wrapper { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); width: 92%; max-width: 500px; z-index: 100; }
        .float-bar { width: 100%; height: 50px; background: var(--p); color: white; padding: 0 20px; border-radius: 50px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 8px 25px rgba(0,86,145,0.4); cursor: pointer; box-sizing: border-box; }
        .float-bar.empty { opacity: 0.5; filter: grayscale(1); }
        
        .cart-preview { display: none; position: absolute; bottom: 60px; left: 0; width: 100%; background: white; border-radius: 15px; box-shadow: 0 -5px 30px rgba(0,0,0,0.2); padding: 15px; border: 1px solid #ccc; max-height: 400px; overflow-y: auto; box-sizing: border-box; }
        .cart-wrapper:hover .cart-preview { display: block; }
        .prev-row { display: flex; align-items: baseline; font-size: 0.75rem; margin-bottom: 6px; color: #444; }
        .prev-dots { flex-grow: 1; border-bottom: 1px dotted #ccc; margin: 0 6px; position: relative; top: -3px; }

        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 200; align-items: flex-end; }
        .m-box { background: #fff; width: 100%; max-width: 600px; margin: 0 auto; border-radius: 20px 20px 0 0; padding: 20px; max-height: 90vh; overflow-y: auto; }
        
        .cart-row { padding: 8px 0; border-bottom: 1px solid #eee; }
        .cart-row-top { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 2px; }
        .cart-row-bot { display: flex; justify-content: space-between; align-items: flex-end; }
        .cart-title { font-weight: 700; font-size: 0.85rem; line-height: 1.2; padding-right: 8px; color: #222; }
        .cart-total-wrap { text-align: right; }
        .cart-total-rub { font-weight: 900; font-size: 0.95rem; color: var(--p); white-space: nowrap; }
        .cart-total-eur { font-weight: 400; font-size: 0.7rem; color: #999; }
        .cart-meta { font-size: 0.7rem; color: #888; line-height: 1.3; }
        
        .forgot-link { color: var(--p); text-align: center; padding: 20px 0; cursor: pointer; text-decoration: underline; font-size: 0.9rem; font-weight: 600; display: block; line-height: 1.4; }
        .undo-box { background: #fff8e1; color: #f57f17; border: 1px dashed #f57f17; padding: 10px; border-radius: 8px; text-align: center; margin-bottom: 10px; cursor: pointer; font-size: 0.8rem; font-weight: bold; }
        
        .upsell-box { background: linear-gradient(135deg, #e8f5e9 0%, #ffffff 100%); border: 1px solid #c8e6c9; border-radius: 12px; padding: 12px 15px; margin: 10px 0; display: flex; align-items: center; cursor: pointer; transition: 0.2s; }
        .upsell-box:active { transform: scale(0.98); }
        .upsell-icon { font-size: 1.4rem; margin-right: 12px; }
        .upsell-tit { font-weight: bold; color: var(--otc); font-size: 0.85rem; }
        .upsell-desc { font-size: 0.7rem; color: #555; margin-top: 1px; }
        .upsell-arr { margin-left: auto; color: var(--otc); font-size: 1.1rem; opacity: 0.5; }

        .email-link { color: #555; text-decoration: underline; font-weight: 700; font-size: 0.9rem; }

    /* --- CLINICAL MINIMALISM (–°—Ç—Ä–æ–≥–∏–π –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π —Å—Ç–∏–ª—å) --- */
/* --- FAQ STYLES (Final) --- */
        .faq-wrapper {
            background: #fff;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-bottom: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            position: relative; /* –î–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è */
        }

        .faq-toggle {
            background: #fff; 
            color: #000;
            padding: 12px 15px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.95rem;
            font-weight: 600;
            transition: background-color 0.2s;
        }
        .faq-toggle:hover { background-color: #f5f5f5; }

        .faq-content { 
            display: none; 
            padding: 20px 15px; 
            border-top: 1px solid #ccc; 
            color: #333;
        }
        .faq-content.show { display: block; }

        .qa-block { margin-bottom: 15px; }
        .qa-block:last-child { margin-bottom: 0; }

        /* –í–æ–ø—Ä–æ—Å: –¢–µ–ø–µ—Ä—å –ß–ï–†–ù–´–ô, –∫–∞–∫ –≤—ã –ø—Ä–æ—Å–∏–ª–∏ */
        .qa-question {
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #000; /* <-- –ß–µ—Ä–Ω—ã–π —Ü–≤–µ—Ç */
            margin-bottom: 5px;
        }

        .qa-answer {
            font-size: 0.9rem;
            color: #333;
            line-height: 1.5;
        }

        /* --- UNIVERSAL BUTTONS & GRID (–°–ø—Ä–∞–≤–∫–∞ + –ö–æ—Ä–∑–∏–Ω–∞) --- */
        .contact-grid { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 10px; 
            margin-top: 15px; 
            padding-top: 15px;
            border-top: 1px dotted #ccc;
        }
        
        /* –ï–¥–∏–Ω—ã–π —Å—Ç–∏–ª—å –¥–ª—è –∫–Ω–æ–ø–æ–∫ –∏ —Å—Å—ã–ª–æ–∫ */
        .c-btn {
            border: none;
            padding: 12px;
            color: #fff !important; /* –í—Å–µ–≥–¥–∞ –±–µ–ª—ã–π —Ç–µ–∫—Å—Ç */
            font-family: -apple-system, sans-serif;
            font-size: 0.85rem;
            font-weight: 700;
            text-align: center;
            text-decoration: none;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 0.2s, transform 0.1s;
            width: 100%;
            box-sizing: border-box;
        }
        
        .c-btn:hover { opacity: 0.9; }
        .c-btn:active { transform: scale(0.98); }
        
        /* –¶–≤–µ—Ç–∞ –±—Ä–µ–Ω–¥–æ–≤ */
        .c-btn.tg { background: #229ED9; }
        .c-btn.wa { background: #25D366; }
        .c-btn.em { 
            background: #555; 
            grid-column: 1 / -1; /* –†–∞—Å—Ç—è–Ω—É—Ç—å –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É */
        }

    </style>
</head>
<body onclick="closeModal()">

<div class="cont">
    <header onclick="event.stopPropagation()">
        <div class="head-top">
            <h1 id="appTitle">üá©üá™ DE –†–µ–µ—Å—Ç—Ä <span class="version-badge global">Online (G-Sheets)</span></h1>
            <span id="topDate" class="top-date"></span>
        </div>
        
        <div id="errorBox"></div>

        <div id="faqWrap" class="faq-wrapper">
            <div class="faq-toggle" onclick="toggleFaq()">
                <span>–°–ø—Ä–∞–≤–∫–∞ –∏ —É—Å–ª–æ–≤–∏—è –∑–∞–∫–∞–∑–∞</span>
                <span id="faqArrow" style="color:#999; font-size:0.8rem;">‚ñº</span>
            </div>

            <div id="faqBody" class="faq-content">
                <div class="qa-block">
                    <div class="qa-question">–û —Å–µ—Ä–≤–∏—Å–µ</div>
                    <div class="qa-answer">–°–µ—Ä–≤–∏—Å –ø—Ä—è–º–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –∏–∑ –ú—é–Ω—Ö–µ–Ω–∞. –ó–∞–∫—É–ø–∞–µ–º –ª–∏—á–Ω–æ –≤ –ª–∏—Ü–µ–Ω–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∞–ø—Ç–µ–∫–∞—Ö. –ß–µ–∫–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º.</div>
                </div>
                <div class="qa-block">
                    <div class="qa-question">–ü—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏–µ</div>
                    <div class="qa-answer">–¢–æ–ª—å–∫–æ –æ—Ä–∏–≥–∏–Ω–∞–ª –¥–ª—è —Ä—ã–Ω–∫–∞ –ì–µ—Ä–º–∞–Ω–∏–∏ (PZN). –†–µ—ç–∫—Å–ø–æ—Ä—Ç –∏—Å–∫–ª—é—á–µ–Ω.</div>
                </div>
                <div class="qa-block">
                    <div class="qa-question">–õ–æ–≥–∏—Å—Ç–∏–∫–∞</div>
                    <div class="qa-answer">–û—Ç–±–æ—Ä –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã—Ö —Å—Ä–æ–∫–æ–≤ –≥–æ–¥–Ω–æ—Å—Ç–∏. –î–æ—Å—Ç–∞–≤–∫–∞ –ü–æ—á—Ç–æ–π (12‚Äì25 –¥–Ω–µ–π). –¢—Ä–µ–∫-–Ω–æ–º–µ—Ä –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è.</div>
                </div>
                <div class="qa-block">
                    <div class="qa-question">–û–ø–ª–∞—Ç–∞</div>
                    <div class="qa-answer">–í —Ä—É–±–ª—è—Ö –Ω–∞ –∫–∞—Ä—Ç—É –±–∞–Ω–∫–∞ –†–§. –ö—É—Ä—Å —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –≤ –º–æ–º–µ–Ω—Ç –∑–∞–∫–∞–∑–∞.</div>
                </div>

                <div class="contact-grid">
                    <a href="https://t.me/remed01?text=–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ%20RxDe,%20—É%20–º–µ–Ω—è%20–≤–æ–ø—Ä–æ—Å:" target="_blank" class="c-btn tg">Telegram</a>
                    <a href="https://wa.me/79650302556?text=–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ%20RxDe,%20—É%20–º–µ–Ω—è%20–≤–æ–ø—Ä–æ—Å:" target="_blank" class="c-btn wa">WhatsApp</a>
                    <a href="mailto:med.zakaz.de@gmail.com?subject=–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ RxDe, —É –º–µ–Ω—è –≤–æ–ø—Ä–æ—Å:" class="c-btn em">–ù–∞–ø–∏—Å–∞—Ç—å –Ω–∞ Email</a>
                </div>
            </div>
        </div>

        <div class="trust-line">
            <span style="opacity:0.7">–ë–∏—Ä–∂–∞: <b id="cbRate">...</b></span>
            
            <span>–ö—É—Ä—Å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏: <b id="finalRate" style="color:var(--p)">... ‚ÇΩ</b></span>
        </div>
    </header>

    <div class="sticky" onclick="event.stopPropagation()">
        <div class="inp-wrap">
            <div id="enterHint" class="hint-text" onclick="completeSearch()"></div>

            <input type="text" id="search" class="search-input" 
                   placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ, –≤–µ—â–µ—Å—Ç–≤–æ, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å..." 
                   oninput="handleInput()" 
                   onkeydown="handleKeys(event)" 
                   autocomplete="off">
                   
            <span class="cls-btn" id="clearBtn" onclick="clearSearch()" style="display:none">‚úï</span>
        </div>
        
        <div class="filter-tags" id="chipBar"></div>
        
        <div class="cat-nav-wrap">
            <div id="catChips"></div>
            <div id="subCatChips"></div>
        </div>
        
        <div id="manBar" class="man-bar">
            <span>–ù–∞–π–¥–µ–Ω–æ: <b id="cnt">0</b></span>
            <span style="text-decoration:underline; font-weight:bold; cursor:pointer;" onclick="copyVisibleItems()">üìÑ –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞</span>
        </div>
    </div>
    
    <div id="list"></div>
</div>

<div class="cart-wrapper" onclick="event.stopPropagation()">
    <div id="cartPreview" class="cart-preview"></div>
    <div id="floatBar" class="float-bar empty" onclick="openCart()">
    <div id="barTotal" style="font-weight:bold;">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>
    <span style="background:rgba(255,255,255,0.2); padding:6px 12px; border-radius:30px; font-weight:bold; font-size:0.8rem">üõí –ö –ó–ê–ö–ê–ó–£</span>
</div>
</div>

<div id="modal" class="modal">
    <div class="m-box" onclick="event.stopPropagation()">
        <h3 style="margin:0 0 15px 0; border-bottom: 2px solid #333; padding-bottom: 10px; display: flex; justify-content: space-between; align-items: center;">
            <span>–ó–∞–∫–∞–∑</span>
            <div style="display:flex; gap:15px; align-items:center;">
                <span onclick="closeModal()" style="cursor:pointer; font-size:1.5rem; line-height:1;">‚úï</span>
            </div>
        </h3>

        <div id="undoArea"></div>
        <div id="cartItems"></div>
        
        <div class="upsell-box" onclick="activateFreeFilter()">
            <div><div class="upsell-desc">–î–æ–±–∞–≤–∏–º –≤ –ø–æ—Å—ã–ª–∫—É –±–µ–∑—Ä–µ—Ü–µ–ø—É—Ä–Ω—ã–µ?</div></div>
            <div class="upsell-arr">‚ûù</div>
        </div>

        <div id="summaryBox" style="background:#f4f6f8; padding:15px; border-radius:10px; margin-top:10px;">
            </div>

        <div class="contact-grid" style="border:none; margin-top:15px; padding-top:0;">
            <button onclick="doShare('tg')" class="c-btn tg">–ó–∞–∫–∞–∑ –≤ Telegram</button>
            <button onclick="doShare('wa')" class="c-btn wa">–ó–∞–∫–∞–∑ –≤ WhatsApp</button>
            <button onclick="doShare('email')" class="c-btn em">–ó–∞–∫–∞–∑ –Ω–∞ Email</button>
        </div>
    </div>
</div>

<script>
    // --- –ù–ê–°–¢–†–û–ô–ö–ò ---
    // –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫: –í–∞—à–∞ Google –¢–∞–±–ª–∏—Ü–∞ (–≤—Å–µ–≥–¥–∞ —Å–≤–µ–∂–∞—è)
    const GOOGLE_DIRECT_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTh9jBKA_RFbB03wt7VljCrZqxM9wBq9aGadw1uHCD4PQ5z5K3YoiF1bkxabc1kzPtP6tA6FLOxOB6b/pub?gid=185046132&single=true&output=csv';
    
    const TG_USER = 'remed01';
    const WA_PHONE = '79650302556';

    // --- –ü–ï–†–ï–ú–ï–ù–ù–´–ï ---
    let db = [], cart = {}, lastDel = null, rateCalc = 0, cbrRate = 0, currentVisible = [];
    
    // –ü–∞–º—è—Ç—å –¥–ª—è —Å—á–µ—Ç—á–∏–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã
    let lastBarEur = 0; 
    let lastBarRub = 0;
    let shipEurGlobal = 0; 

    // –§–∏–ª—å—Ç—Ä—ã
    let filters = { search: '', manuf: null, subst: null, subst_ru: null, dosage: null, size: null, cat: 'ALL', subcat: null, onlyFree: false, form: null };
    
    const searchFields = ['PZN', 'Name_DE', 'Name_RU', 'Hersteller', 'Substance', 'Substance_RU', 'Dosage', 'Size', 'Category', 'Form'];

    // –û—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ
    function toggleFaq() {
        const body = document.getElementById('faqBody');
        const arrow = document.getElementById('faqArrow');
        
        if (body.classList.contains('show')) {
            body.classList.remove('show');
            arrow.innerText = '‚ñº';
        } else {
            body.classList.add('show');
            arrow.innerText = '‚ñ≤';
        }
    }

    // –ó–ê–ö–†–´–¢–ò–ï –ü–†–ò –ö–õ–ò–ö–ï –í–ù–ï –°–ü–†–ê–í–ö–ò
    document.addEventListener('click', function(event) {
        const wrap = document.getElementById('faqWrap');
        const body = document.getElementById('faqBody');
        
        // –ï—Å–ª–∏ –∫–ª–∏–∫–Ω—É–ª–∏ –ù–ï –ø–æ —Å–ø—Ä–∞–≤–∫–µ, –∏ –æ–Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∞ -> –∑–∞–∫—Ä—ã–≤–∞–µ–º
        if (wrap && !wrap.contains(event.target) && body.classList.contains('show')) {
            toggleFaq();
        }
    });

    function init() {
        // 1. –î–∞—Ç–∞
        const d = new Date();
        const dateStr = d.toLocaleDateString('ru-RU', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
        document.getElementById('topDate').innerText = dateStr.charAt(0).toUpperCase() + dateStr.slice(1);

        // 2. –ö–æ—Ä–∑–∏–Ω–∞
        const saved = localStorage.getItem('de_cart'); 
        if (saved) cart = JSON.parse(saved);

        // 3. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ä–µ–¥—ã (Local vs Global) –¥–ª—è –∑–Ω–∞—á–∫–∞
        const hostname = window.location.hostname;
        const isLocal = hostname === '' || hostname === 'localhost' || hostname === '127.0.0.1' || window.location.protocol === 'file:';
        
        const badgeClass = isLocal ? 'local' : 'global';
        const badgeText = isLocal ? 'v100.53 Local' : 'v100.53 Global';

        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å –≤–µ—Ä—Å–∏–µ–π
        document.getElementById('appTitle').innerHTML = `üá©üá™ DE –†–µ–µ—Å—Ç—Ä <span class="version-badge ${badgeClass}">${badgeText}</span>`;

        // 4. –ó–ê–ì–†–£–ó–ö–ê –ë–ê–ó–´ (–í—Å–µ–≥–¥–∞ –∏–∑ Google, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –∑–Ω–∞—á–∫–∞)
        console.log("üì° –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets...");
        
        Papa.parse(GOOGLE_DIRECT_URL, { 
            download: true, 
            header: true, 
            skipEmptyLines: true, 
            complete: (res) => { 
                db = res.data;
                if(db.length > 0) {
                    console.log(`‚úÖ –£—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ ${db.length} —Ç–æ–≤–∞—Ä–æ–≤.`);
                    processData(db); 
                    // --- –í–û–¢ –°–Æ–î–ê –î–û–ë–ê–í–ò–¢–¨ –≠–¢–£ –°–¢–†–û–ß–ö–£ ---
                    restoreOrderFromUrl(); 
                    // -------------------------------------
                } else {
                    showError("–¢–∞–±–ª–∏—Ü–∞ –∑–∞–≥—Ä—É–∑–∏–ª–∞—Å—å, –Ω–æ –æ–Ω–∞ –ø—É—Å—Ç–∞—è.");
                }
            },
            error: (err) => {
                showError(`–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏ —Å Google: ${err.message}. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç.`);
            }
        });
    }

    function processData(data) {
        document.getElementById('errorBox').style.display = 'none';
        const settingsRow = data[0];
        
        // –ë–ï–†–ï–ú –ö–£–†–° –ò–ó –¢–ê–ë–õ–ò–¶–´ (–§–æ—Ä–º—É–ª–∞ GoogleFinance)
        // –ï—Å–ª–∏ —Ç–∞–º –ø—É—Å—Ç–æ –∏–ª–∏ —Å–±–æ–π, –±–µ—Ä–µ–º 100 –∫–∞–∫ –∞–≤–∞—Ä–∏–π–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
        const tableRate = parseFloat(settingsRow.Current_Rate?.replace(',', '.') || 100);
        
        console.log("üí∞ –ö—É—Ä—Å –∏–∑ Google –¢–∞–±–ª–∏—Ü—ã:", tableRate);
        updateCalculations(settingsRow, tableRate);
    }

    function updateCalculations(firstRow, currentCbr) {
        const bankMargin = parseFloat(firstRow.Bank_Smena?.replace(',', '.') || 0);
        shipEurGlobal = parseFloat(firstRow.Mail_EURO?.replace(',', '.') || 0);
        
        rateCalc = currentCbr + bankMargin;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —à–∞–ø–∫—É
        document.getElementById('cbRate').innerText = currentCbr.toFixed(2);
        document.getElementById('finalRate').innerText = rateCalc.toFixed(2) + ' ‚ÇΩ';
        
        // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å –Ω–æ–≤—ã–º–∏ —Ü–µ–Ω–∞–º–∏
        updateBar(); 
        render(); 
        renderPreview();
    }

    // –î–í–ò–ñ–û–ö –≠–§–§–ï–ö–¢–ê –ë–ï–ù–ó–û–ö–û–õ–û–ù–ö–ò (–î–ª—è –∫–æ—Ä–∑–∏–Ω—ã)
    function animateValue(id, start, end, duration, isFloat) {
        const obj = document.getElementById(id);
        if (!obj) return;
        if (start === end) {
            obj.innerHTML = isFloat ? end.toFixed(2) + " ‚Ç¨" : "‚âà " + Math.round(end).toLocaleString() + " ‚ÇΩ";
            return;
        }
        let startTimestamp = null;
        const step = (timestamp) => {
            if (!startTimestamp) startTimestamp = timestamp;
            const progress = Math.min((timestamp - startTimestamp) / duration, 1);
            const currentVal = start + (end - start) * progress;
            if (isFloat) {
                obj.innerHTML = currentVal.toFixed(2) + " ‚Ç¨";
            } else {
                obj.innerHTML = "‚âà " + Math.round(currentVal).toLocaleString() + " ‚ÇΩ";
            }
            if (progress < 1) {
                window.requestAnimationFrame(step);
            } else {
                obj.innerHTML = isFloat ? end.toFixed(2) + " ‚Ç¨" : "‚âà " + Math.round(end).toLocaleString() + " ‚ÇΩ";
            }
        };
        window.requestAnimationFrame(step);
    }

    function updateBar() {
        let totalEur = 0, count = 0; 
        db.forEach(r => { 
            if(cart[r.PZN]) { 
                const eurPrice = parseFloat(r.Price?.toString().replace(',','.') || 0);
                totalEur += eurPrice * cart[r.PZN]; 
                count += cart[r.PZN]; 
            } 
        });
        
        const totalRub = getRubPrice(totalEur);
        const floatBar = document.getElementById('floatBar');
        const barTotal = document.getElementById('barTotal');
        
        if (!floatBar || !barTotal) return; 

        floatBar.classList.toggle('empty', count === 0);
        
        if(count > 0) {
            barTotal.innerHTML = `
                <div style="display:flex; flex-direction:column; gap:1px; line-height:1.2; text-align:left;">
                    <div style="display:flex; align-items:baseline; gap:7px;">
                        <span id="animEur" style="font-size:1.1rem; font-weight:900; color:#fff; min-width:70px;">
                            ${lastBarEur.toFixed(2)} ‚Ç¨
                        </span>
                        <span id="animRub" style="font-size:0.8rem; font-weight:400; opacity:0.9; white-space:nowrap;">
                            ‚âà ${Math.round(lastBarRub).toLocaleString()} ‚ÇΩ
                        </span>
                    </div>
                    <div style="font-size:0.6rem; font-weight:normal; opacity:0.8;">+ –ø–æ—á—Ç–∞ –∏–∑ –ì–µ—Ä–º–∞–Ω–∏–∏ ${shipEurGlobal}‚Ç¨</div>
                </div>`;

            setTimeout(() => {
                animateValue("animEur", lastBarEur, totalEur, 500, true); 
                animateValue("animRub", lastBarRub, totalRub, 500, false);
                lastBarEur = totalEur;
                lastBarRub = totalRub;
            }, 10);
        } else {
            barTotal.innerHTML = `<span style="font-size:1rem; opacity:0.7">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</span>`;
            lastBarEur = 0;
            lastBarRub = 0;
        }
    }

    function getRubPrice(eurPriceStr) {
        if (!eurPriceStr) return 0;
        const eur = parseFloat(eurPriceStr.toString().replace(/\s/g, '').replace(',', '.'));
        if (isNaN(eur)) return 0;
        return Math.floor((eur * rateCalc) / 100) * 100;
    }

    // --- –§–£–ù–ö–¶–ò–ò –ò–ù–¢–ï–†–§–ï–ô–°–ê (–ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô) ---
    function copyVisibleItems() {
        let text = "–°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ —Ä–µ–µ—Å—Ç—Ä–∞ RXDE:\n";
        if(currentVisible.length > 0) {
             currentVisible.forEach(r => {
                const rub = getRubPrice(r.Price);
                if (rub > 0) text += `${r.Name_DE} (${r.Form}) ‚Äî ${r.Price} ‚Ç¨ (‚âà ${rub.toLocaleString()} ‚ÇΩ)\n`;
             });
        } else { text = "–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç"; }
        navigator.clipboard.writeText(text).then(() => {
            const btn = document.querySelector('.man-bar span[onclick="copyVisibleItems()"]');
            btn.innerText = "‚úÖ –°–ø–∏—Å–æ–∫ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!";
            setTimeout(() => btn.innerText = "üìÑ –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞", 2000);
        });
    }

    function showError(msg) {
        const box = document.getElementById('errorBox');
        box.innerHTML = "‚ö†Ô∏è " + msg;
        box.style.display = "block";
    }

    function handleInput() {
        const input = document.getElementById('search'); 
        const hint = document.getElementById('enterHint');
        filters.search = input.value; 
        document.getElementById('clearBtn').style.display = input.value ? 'block' : 'none';

        if (input.value.length > 0 && (filters.cat !== 'ALL' || filters.manuf || filters.subst || filters.subst_ru || filters.dosage || filters.size || filters.onlyFree || filters.form)) {
             filters.cat = 'ALL'; filters.subcat = null; filters.manuf = null; filters.subst = null; filters.subst_ru = null; filters.dosage = null; filters.size = null; filters.onlyFree = false; filters.form = null;
             renderCats(); 
        }
        if (!input.value) { hint.classList.remove('show'); render(); return; }

        if(filters.search.length >= 2) {
            const lowSearch = filters.search.toLowerCase();
            const match = db.find(r => searchFields.some(f => r[f] && r[f].toLowerCase().startsWith(lowSearch)));
            if(match) {
                const foundField = searchFields.find(f => match[f] && match[f].toLowerCase().startsWith(lowSearch));
                const fullText = match[foundField];
                if (fullText.toLowerCase().startsWith(input.value.toLowerCase())) {
                    const fullTail = fullText.substring(input.value.length);
                    let visualTail = fullTail;
                    let spaceIdx = fullTail.indexOf(' ');
                    if (spaceIdx === 0) spaceIdx = fullTail.indexOf(' ', 1);
                    if (spaceIdx !== -1) visualTail = fullTail.substring(0, spaceIdx);
                    
                    const cleanText = visualTail.trim(); 
                    if (!cleanText) { hint.classList.remove('show'); } else {
                        hint.innerText = cleanText;
                        hint.dataset.full = fullText; 
                        hint.classList.add('show');
                    }
                } else { hint.classList.remove('show'); }
            } else { hint.classList.remove('show'); }
        } else { hint.classList.remove('show'); }
        render();
    }

    function completeSearch() {
        const hint = document.getElementById('enterHint');
        const input = document.getElementById('search');
        const fullText = hint.dataset.full; 
        if (fullText && hint.classList.contains('show')) {
            const currentLen = input.value.length;
            const rem = fullText.substring(currentLen);
            const spaceIdx = rem.indexOf(' '); 
            let nextPart = (spaceIdx !== -1) ? rem.substring(0, spaceIdx + 1) : rem + ' ';
            input.value = input.value + nextPart; 
            input.focus();
            handleInput(); 
        }
    }

    function handleKeys(e) {
        const input = document.getElementById('search'); 
        const hint = document.getElementById('enterHint');
        if (e.key === 'Backspace' && input.value.endsWith(' ')) {
            if (e.keyCode !== 229) {
                e.preventDefault();
                const words = input.value.trim().split(/\s+/);
                words.pop();
                input.value = words.length > 0 ? words.join(' ') + ' ' : '';
                handleInput();
            }
        }
        if (e.key === 'Enter') {
            e.preventDefault();
            input.blur(); 
            hint.classList.remove('show'); 
            return;
        }
        if ((e.key === 'Tab' || e.key === 'ArrowRight') && hint.classList.contains('show')) {
            e.preventDefault(); 
            completeSearch();
        }
    }

    function levenshtein(a, b) {
        if(a.length === 0) return b.length; 
        if(b.length === 0) return a.length;
        const matrix = [];
        for(let i = 0; i <= b.length; i++){ matrix[i] = [i]; }
        for(let j = 0; j <= a.length; j++){ matrix[0][j] = j; }
        for(let i = 1; i <= b.length; i++){
            for(let j = 1; j <= a.length; j++){
                if(b.charAt(i-1) == a.charAt(j-1)){ matrix[i][j] = matrix[i-1][j-1]; } else {
                    matrix[i][j] = Math.min(matrix[i-1][j-1] + 1, Math.min(matrix[i][j-1] + 1, matrix[i-1][j] + 1));
                }
            }
        }
        return matrix[b.length][a.length];
    }

    function render() {
        const list = document.getElementById('list'); list.innerHTML = '';
        const chipBar = document.getElementById('chipBar'); chipBar.innerHTML = '';
        const labels = {manuf:'üè≠', subst:'üß™', subst_ru:'üá∑üá∫', dosage:'‚öñÔ∏è', size:'üì¶', form:'üíä'};
        Object.keys(labels).forEach(key => { if (filters[key]) chipBar.innerHTML += `<div class="chip">${labels[key]} ${filters[key]} <b onclick="setHardFilter('${key}', null)">√ó</b></div>`; });
        
        const sWords = filters.search.toLowerCase().trim().split(/\s+/).filter(w => w.length > 0);
        
        currentVisible = db.filter(r => {
            if(!r.Name_DE) return false;
            const rVal = (r.R || "").toString().trim();
            const isRx = (rVal !== "" && rVal !== "0" && rVal.toLowerCase() !== "no");
            if (filters.onlyFree && isRx) return false;
            if(filters.cat !== 'ALL') {
                const itemCats = r.Category ? r.Category.split(',').map(c => c.trim()) : [];
                const matchesParent = itemCats.some(c => c.split('/')[0].trim() === filters.cat);
                if (!matchesParent) return false;
                if (filters.subcat) {
                    const matchesSub = itemCats.some(c => c.split('/').length > 1 && c.split('/')[1].trim() === filters.subcat);
                    if (!matchesSub) return false;
                }
            }
            if(filters.manuf && r.Hersteller !== filters.manuf) return false;
            if(filters.subst && r.Substance !== filters.subst) return false;
            if(filters.subst_ru && r.Substance_RU !== filters.subst_ru) return false;
            if(filters.dosage && r.Dosage !== filters.dosage) return false;
            if(filters.size && r.Size !== filters.size) return false;
            if(filters.form && r.Form !== filters.form) return false;
            return sWords.every(word => searchFields.some(f => r[f] && r[f].toLowerCase().includes(word)));
        });

        document.getElementById('manBar').style.display = (filters.search || filters.manuf || filters.subst || filters.subst_ru || filters.cat !== 'ALL' || filters.onlyFree) ? 'flex' : 'none';
        document.getElementById('cnt').innerText = currentVisible.length;

        if (currentVisible.length === 0 && filters.search) {
            let suggestion = null;
            if (filters.search.length > 2) {
                const searchLower = filters.search.toLowerCase();
                for(let r of db) {
                    let candidates = [];
                    if(r.Substance) candidates.push(r.Substance);
                    if(r.Substance_RU) candidates.push(r.Substance_RU);
                    if(r.Name_DE) candidates.push(r.Name_DE.split(' ')[0]);
                    if(r.Hersteller) candidates.push(r.Hersteller.split(' ')[0]);
                    if(r.Name_RU) candidates.push(r.Name_RU.split(' ')[0]);
                    if(r.Category) {
                        r.Category.split(',').forEach(c => {
                            c.split('/').forEach(sub => candidates.push(sub.trim()));
                        });
                    }
                    for(let c of candidates) {
                        if(c && Math.abs(c.length - searchLower.length) <= 3 && c.toLowerCase() !== searchLower) {
                            if (levenshtein(searchLower, c.toLowerCase()) <= 2) { suggestion = c; break; }
                        }
                    }
                    if(suggestion) break;
                }
            }
            const didYouMean = suggestion ? `<div class="did-you-mean" onclick="setSearch('${suggestion}')">–í–æ–∑–º–æ–∂–Ω–æ, –≤—ã –∏—Å–∫–∞–ª–∏: <u>${suggestion}</u>?</div>` : '';
            list.innerHTML = `<div class="empty-state">${didYouMean}<h3>üîç –ü–æ–∑–∏—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞</h3><p>–í —Ç–µ–∫—É—â–µ–π –±–∞–∑–µ –Ω–µ –≤—Å–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞. –ù–∞–ø–∏—à–∏—Ç–µ –Ω–∞–º!</p><div class="empty-btns"><button class="eb-btn" style="background:#229ED9" onclick="doShare('tg','–ó–∞–ø—Ä–æ—Å –ø–æ–∏—Å–∫–∞: ' + filters.search)">Telegram</button><button class="eb-btn" style="background:#25D366" onclick="doShare('wa','–ó–∞–ø—Ä–æ—Å –ø–æ–∏—Å–∫–∞: ' + filters.search)">WhatsApp</button></div></div>`;
        } else {
            currentVisible.forEach(r => {
                const rub = getRubPrice(r.Price);
                if(!rub && rub !== 0) return;
                const q = cart[r.PZN] || 0;
                const imgH = r.Image ? `<div class="cam-wrap">üì∑<img class="preview-img" src="img/${r.Image}"></div>` : '';
                const rVal = (r.R || "").toString().trim();
                const isRx = (rVal !== "" && rVal !== "0" && rVal.toLowerCase() !== "no");
                const checkLink = (isRx && r.Price_chek) ? `<a href="${r.Price_chek}" target="_blank" class="check-btn">üîó Check</a>` : '';
                
                let cleanDate = ''; let dateStyle = '';
                if (r.Last_Update) {
                    cleanDate = r.Last_Update.split(' ')[0]; 
                    const parts = cleanDate.split('.');
                    if(parts.length === 3) {
                        const d = new Date(parts[2], parts[1]-1, parts[0]);
                        const diff = (new Date() - d) / (1000 * 60 * 60 * 24);
                        if (diff <= 30) { dateStyle = 'background: radial-gradient(circle at 30% 30%, #69f0ae, #00c853); box-shadow: 0 2px 4px rgba(0,200,83,0.3);'; } 
                        else { dateStyle = 'background: radial-gradient(circle at 30% 30%, #ffcc80, #ef6c00); box-shadow: 0 2px 4px rgba(239,108,0,0.3);'; }
                    }
                }
                
                list.innerHTML += `<div class="card ${q>0?'selected-item':''}">
                    <div style="flex:1">
                        <div style="line-height:1.4"><span class="c-tit-line">${r.Name_DE}</span> ${imgH} <span class="badge ${isRx?'rx':'free'}">${isRx?'RX':'Free'}</span>${checkLink}</div>
                        <span style="font-size:0.7rem; color:#999; display:block; margin-top:2px;">PZN: ${r.PZN}</span>
                        <div style="margin-top:5px; display:flex; flex-wrap:wrap; gap:4px">
                            <span class="t-lnk ${filters.manuf===r.Hersteller?'active-f':''}" onclick="setHardFilter('manuf','${r.Hersteller}')">${r.Hersteller}</span>
                            <span class="t-lnk ${filters.subst===r.Substance?'active-f':''}" onclick="setHardFilter('subst','${r.Substance}')">${r.Substance}</span>
                            ${r.Form ? `<span class="t-lnk ${filters.form===r.Form?'active-f':''}" onclick="setHardFilter('form','${r.Form}')">${r.Form}</span>` : ''}
                            ${r.Substance_RU ? `<span class="t-lnk ${filters.subst_ru===r.Substance_RU?'active-f':''}" onclick="setHardFilter('subst_ru','${r.Substance_RU}')">üá∑üá∫ ${r.Substance_RU}</span>` : ''}
                            <span class="t-lnk ${filters.dosage===r.Dosage?'active-f':''}" onclick="setHardFilter('dosage','${r.Dosage}')">${r.Dosage}</span>
                            <span class="t-lnk ${filters.size===r.Size?'active-f':''}" onclick="setHardFilter('size','${r.Size}')">${r.Size || 'üì¶'}</span>
                        </div>
                    </div>
                    <div style="text-align:right; min-width:95px;">
                        <div style="font-weight:900; font-size:1.2rem; color:#000;">${r.Price} ‚Ç¨</div>
                        <div style="font-size:0.85rem; font-weight:600; color:var(--p); margin-top:2px;">‚âà ${rub.toLocaleString()} ‚ÇΩ</div>
                        <div style="font-size:0.65rem; margin-top:4px; text-align:right; display:flex; align-items:center; justify-content:flex-end; color:#888;">
                            <span style="display:inline-block; width:10px; height:10px; border-radius:50%; margin-right:5px; ${dateStyle}"></span>${cleanDate}
                        </div>
                        <div class="qty-wrap"><button class="btn-qty" onclick="modQty('${r.PZN}',-1)">‚àí</button><span style="width:20px;text-align:center;font-weight:bold">${q}</span><button class="btn-qty add" onclick="modQty('${r.PZN}',1)">+</button></div>
                    </div>
                </div>`;
            });
        }
        renderCats();
    }

    function renderCats() {
        const parents = new Set(['ALL']);
        const subcategories = new Set();
        const freeCategories = new Set();

        db.forEach(r => {
            if (r.Category) {
                r.Category.split(',').forEach(rawCat => {
                    const parts = rawCat.split('/');
                    const p = parts[0].trim();
                    if (p) parents.add(p);
                    if (filters.cat !== 'ALL' && p === filters.cat && parts.length > 1) subcategories.add(parts[1].trim());
                    
                    const rVal = (r.R || "").toString().trim();
                    const isRx = (rVal !== "" && rVal !== "0" && rVal.toLowerCase() !== "no");
                    if (!isRx && p) freeCategories.add(p);
                });
            }
        });

        const d = document.getElementById('catChips'); d.innerHTML = '';
        Array.from(parents).sort().forEach(c => {
            const btn = document.createElement('div');
            btn.innerText = (c === 'ALL' ? '–í—Å–µ' : c);
            btn.className = `cat-btn ${filters.cat === c ? 'active' : ''}`;
            btn.onclick = () => { filters.search = ''; filters.manuf = null; filters.subst = null; filters.subst_ru = null; filters.dosage = null; filters.size = null; filters.onlyFree = false; filters.subcat = null; filters.cat = c; document.getElementById('search').value = ''; handleInput(); };
            d.appendChild(btn);
        });

        const freeBtn = document.createElement('div');
        freeBtn.innerText = '‚òòÔ∏è –ë–µ–∑ —Ä–µ—Ü–µ–ø—Ç–∞';
        freeBtn.className = `cat-btn free-filter ${filters.onlyFree ? 'active' : ''}`;
        freeBtn.onclick = () => { filters.onlyFree = !filters.onlyFree; if (filters.onlyFree) { filters.cat = 'ALL'; filters.subcat = null; } document.getElementById('search').value = ''; filters.search = ''; handleInput(); };
        d.appendChild(freeBtn);

        const sd = document.getElementById('subCatChips'); sd.innerHTML = ''; sd.style.display = 'none';
        if (filters.cat !== 'ALL' && subcategories.size > 0) {
            sd.style.display = 'flex'; 
            Array.from(subcategories).sort().forEach(sc => {
                const btn = document.createElement('div'); btn.innerText = sc; btn.className = `sub-cat-btn ${filters.subcat === sc ? 'active' : ''}`;
                btn.onclick = () => { filters.subcat = (filters.subcat === sc) ? null : sc; document.getElementById('search').value = ''; filters.search = ''; handleInput(); };
                sd.appendChild(btn);
            });
        } else if (filters.onlyFree && filters.cat === 'ALL' && freeCategories.size > 0) {
            sd.style.display = 'flex';
            Array.from(freeCategories).sort().forEach(fc => {
                const btn = document.createElement('div'); btn.innerText = fc; btn.className = 'sub-cat-btn';
                btn.onclick = () => { filters.cat = fc; document.getElementById('search').value = ''; filters.search = ''; handleInput(); };
                sd.appendChild(btn);
            });
        }
    }

    function setSearch(val) { document.getElementById('search').value = val; handleInput(); }
    function setHardFilter(t, v) { filters[t] = (filters[t] === v) ? null : v; document.getElementById('search').value = ''; filters.search = ''; handleInput(); }
    
    function modQty(pzn, d) {
        if (cart[pzn] === 1 && d < 0) { lastDel = { pzn: pzn, qty: 1 }; setTimeout(() => { lastDel = null; renderCartItems(); renderPreview(); }, 7000); }
        cart[pzn] = (cart[pzn] || 0) + d; if(cart[pzn] <= 0) delete cart[pzn];
        localStorage.setItem('de_cart', JSON.stringify(cart)); updateBar(); render(); renderCartItems(); renderPreview();
        if(document.getElementById('modal').style.display === 'flex') renderCartItems();
    }

    function renderPreview() {
        const div = document.getElementById('cartPreview'); 
        let html = '<div style="font-weight:900; font-size:0.85rem; border-bottom:1px solid var(--p); padding-bottom:4px; margin-bottom:8px; color:var(--p)">–°–û–°–¢–ê–í –ó–ê–ö–ê–ó–ê:</div>';
        let count = 0; let totalEur = 0;
        db.forEach(r => { 
            if(cart[r.PZN]) { 
                count++; 
                const qty = cart[r.PZN];
                const priceEur = parseFloat(r.Price.toString().replace(',', '.'));
                const lineSumEur = Math.round(priceEur * qty); 
                totalEur += lineSumEur;
                const lineSumRub = getRubPrice(lineSumEur);
                html += `<div style="margin-bottom: 8px; border-bottom: 1px solid #f0f0f0; padding-bottom: 4px;"><div style="font-size: 0.75rem; font-weight: bold; color: #333;">${count}. ${r.Name_DE}, , ${r.Form}, ${r.Hersteller}</div><div style="display: flex; justify-content: space-between; align-items: baseline; font-size: 0.7rem; color: #666; margin-top: 2px;"><span>PZN: ${r.PZN}</span><span> ${Math.round(priceEur)}‚Ç¨ √ó ${qty}pack = <b style="color:#000">${lineSumEur}‚Ç¨</b></span></div><div style="text-align: right; font-size: 0.65rem; color: var(--p); opacity: 0.8;">‚âà ${lineSumRub.toLocaleString()} ‚ÇΩ</div></div>`;
            } 
        });
        if (count === 0) { div.innerHTML = '<div style="text-align:center; color:#999; font-size:0.8rem">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>'; } 
        else {
            const totalRub = getRubPrice(totalEur);
            html += `<div style="margin-top:10px; padding-top:5px; border-top: 2px solid var(--p); text-align: right;"><div style="font-size: 0.9rem; font-weight: 900;">–ò–¢–û–ì–û: ${Math.round(totalEur)} ‚Ç¨</div><div style="font-size: 0.75rem; color: var(--p); font-weight: 600;">‚âà ${totalRub.toLocaleString()} ‚ÇΩ</div></div>`;
            div.innerHTML = html;
        }
    }

    function renderCartItems() {
        const div = document.getElementById('cartItems'); div.innerHTML = ''; 
        const uArea = document.getElementById('undoArea'); uArea.innerHTML = '';
        let totalEur = 0, i = 1;
        if (lastDel) uArea.innerHTML = `<div class="undo-box" onclick="undo()">‚Ü©Ô∏è –°–ª—É—á–∞–π–Ω–æ —É–¥–∞–ª–∏–ª–∏? –í–µ—Ä–Ω—É—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</div>`;
        db.forEach(r => { 
            if(cart[r.PZN]) { 
                const qty = cart[r.PZN];
                const priceEur = parseFloat(r.Price.toString().replace(',', '.'));
                const lineSumEur = Math.round(priceEur * qty); 
                totalEur += lineSumEur;
                const lineSumRub = getRubPrice(lineSumEur);
                div.innerHTML += `<div class="cart-row" style="border-bottom: 1px dashed #ccc; padding: 12px 0;"><div class="cart-row-top" style="display: flex; justify-content: space-between; align-items: flex-start;"><div class="cart-title" style="font-weight: 700; font-size: 0.85rem; flex: 1; padding-right: 10px;">${i++}. ${r.Name_DE}, ${r.Form}, ${r.Hersteller}</div><div style="text-align: right; min-width: 100px;"><div style="font-weight: 900; font-size: 1.1rem; color: #000;">${lineSumEur} ‚Ç¨</div><div style="font-size: 0.75rem; color: var(--p); font-weight: 600;">‚âà ${lineSumRub.toLocaleString()} ‚ÇΩ</div></div></div><div class="cart-row-bot" style="margin-top: 8px; display: flex; justify-content: space-between; align-items: flex-end;"><div style="font-size: 0.75rem; color: #666; line-height: 1.4;">PZN: ${r.PZN}<br><span style="color: #333; font-weight: 600;">${qty} pack √ó ${Math.round(priceEur)} ‚Ç¨ = ${lineSumEur} ‚Ç¨</span></div><div style="display:flex; gap:8px; align-items:center;"><button class="btn-qty" style="width:30px; height:30px; font-size:1.2rem" onclick="modQty('${r.PZN}',-1)">‚àí</button><b style="font-size:1.1rem; width:20px; text-align:center;">${qty}</b><button class="btn-qty add" style="width:30px; height:30px; font-size:1.2rem" onclick="modQty('${r.PZN}',1)">+</button></div></div></div>`; 
            } 
        });
        
        const goodsEur = Math.round(totalEur);
        const goodsRub = getRubPrice(goodsEur);
        const shipRub = Math.floor((shipEurGlobal * rateCalc) / 100) * 100;
        const grandTotalEur = goodsEur + shipEurGlobal;
        const grandTotalRub = goodsRub + shipRub;

        const summaryBox = document.getElementById('summaryBox');
        if (summaryBox) {
            summaryBox.style.background = 'transparent';
            summaryBox.style.padding = '15px 0 0 0';
            summaryBox.style.borderTop = '2px solid #000'; 
            summaryBox.style.borderRadius = '0';
            summaryBox.style.marginTop = '20px';
            summaryBox.innerHTML = `<div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 8px; color: #222;"><span style="font-size: 0.95rem; font-weight: bold; margin-right: 10px;">–°—É–º–º–∞ –∫–æ—Ä–∑–∏–Ω—ã:</span><div style="text-align:right; white-space: nowrap;"><span style="font-weight:900; font-size:1.15rem;">${goodsEur} ‚Ç¨</span> <span style="display:block; color:#999; font-size:0.85em; font-weight:bold; margin-top:-2px;">(‚âà ${goodsRub.toLocaleString()} ‚ÇΩ)</span></div></div><div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 15px; color: #555;"><span style="display:flex; align-items:center; gap:6px; font-weight:bold; font-size: 0.95rem; margin-right: 10px; line-height: 1.2;"><span style="font-size:1.2em">üìØ</span> Deutsche Post (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–∞—Ä–∏—Ñ)</span><div style="text-align:right; white-space: nowrap;"><span style="font-weight:900; font-size:1.15rem;">+${shipEurGlobal} ‚Ç¨</span><span style="display:block; font-size:0.85em; opacity:0.8; font-weight:normal; margin-top:-2px;">(‚âà ${shipRub.toLocaleString()} ‚ÇΩ)</span></div></div><div style="display:flex; justify-content:space-between; align-items:center; margin-top: 10px;"><span style="font-weight:900; font-size:1.2rem; color:#000; margin-right: 10px;">–ò–¢–û–ì–û –° –î–û–°–¢–ê–í–ö–û–ô:</span><div style="text-align:right; line-height:1.1; white-space: nowrap;"><div style="font-weight:900; font-size:1.6rem; color:#000;">${grandTotalEur} ‚Ç¨</div><div id="finalSum" style="font-size:0.9rem; color:var(--p); font-weight:bold;">(‚âà ${grandTotalRub.toLocaleString()} ‚ÇΩ)</div></div></div>`;
        }
    }

    function doShare(app, customText) { 
        if (Object.keys(cart).length === 0 && !customText) return;
        
        let totalEur = 0; let count = 0; 
        
        // –ú–∞—Å—Å–∏–≤ –¥–ª—è "—É–º–Ω–æ–π —Å—Å—ã–ª–∫–∏"
        let orderCodeParts = []; 

        const now = new Date();
        const dateTimeStr = now.toLocaleString('ru-RU', { day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit' });
        
        // --- –®–ê–ü–ö–ê ---
        let text = `–ó –ê –ö –ê –ó   R X D E\n`;
        text += `==========================\n`;
        text += `–°–∞–π—Ç: rxde.online\n`;
        text += `–î–∞—Ç–∞: ${dateTimeStr}\n`;
        text += `–ö—É—Ä—Å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏: ${rateCalc.toFixed(2)} RUB/EUR\n`;
        text += `--------------------------\n\n`;

        if(!customText) {
            db.forEach(r => { 
                if(cart[r.PZN]) {
                    count++;
                    const qty = cart[r.PZN];
                    const priceEur = parseFloat(r.Price.toString().replace(',','.'));
                    const lineSumEur = Math.round(priceEur * qty); 
                    totalEur += lineSumEur;
                    
                    // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ: PZN*QTY
                    orderCodeParts.push(`${r.PZN}*${qty}`);

                    // –¢–æ–≤–∞—Ä
                    text += `${count}. ${r.Name_DE}\n`;
                    text += `–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å: ${r.Hersteller}\n`;
                    text += `PZN: ${r.PZN} ... ${Math.round(priceEur)} EUR √ó ${qty} pack = ${lineSumEur} EUR\n\n`;
                } 
            }); 
            
            const goodsEur = Math.round(totalEur);
            const finalEur = goodsEur + shipEurGlobal;
            const finalRub = Math.floor((finalEur * rateCalc) / 100) * 100;
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å—Å—ã–ª–∫—É. –ò—Å–ø–æ–ª—å–∑—É–µ–º # —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞—Ç—å —Å–µ—Ä–≤–µ—Ä –ª–∏—à–Ω–∏–π —Ä–∞–∑ –ø—Ä–∏ –∫–ª–∏–∫–µ
            // –ü—Ä–∏–º–µ—Ä: https://rxde.online/#order=08767020*5-12345678*1
            const fullOrderId = orderCodeParts.join('-');
            const orderLink = `https://rxde.online/#order=${fullOrderId}`;

            // --- –ü–û–î–í–ê–õ ---
            text += `--------------------------\n`;
            text += `–¢–æ–≤–∞—Ä—ã: ${goodsEur} EUR\n`;
            text += `–õ–æ–≥–∏—Å—Ç–∏–∫–∞ (Deutsche Post): ${shipEurGlobal} EUR\n`;
            text += `==========================\n`;
            text += `–ò–¢–û–ì–û (EUR): ${goodsEur} + ${shipEurGlobal} = ${finalEur} EUR\n`;
            text += `–ö –û–ü–õ–ê–¢–ï (RUB): ${finalEur} √ó ${rateCalc.toFixed(2)} = ${finalRub.toLocaleString()} RUB\n`;
            text += `==========================\n`;
            // –ö—Ä–∞—Å–∏–≤–∞—è —Å—Å—ã–ª–∫–∞ –≤–º–µ—Å—Ç–æ —Å—Ç—Ä–∞—à–Ω–æ–≥–æ –∫–æ–¥–∞
            text += `üîó –°—Å—ã–ª–∫–∞ –Ω–∞ –∑–∞–∫–∞–∑:\n${orderLink}`;

        } else { text += customText; }
        
        if (app === 'tg') {
            window.open(`https://t.me/${TG_USER}?text=${encodeURIComponent(text)}`);
        } else if (app === 'wa') {
            window.open(`https://wa.me/${WA_PHONE}?text=${encodeURIComponent(text)}`);
        } else if (app === 'email') {
            const emailBody = text.replace(/\n/g, '%0D%0A'); 
            window.location.href = `mailto:med.zakaz.de@gmail.com?subject=–ó–ê–ö–ê–ó RXDE&body=${emailBody}`;
        }
    }
    
    function openCart() { document.getElementById('modal').style.display = 'flex'; renderCartItems(); }
    function closeModal() { document.getElementById('modal').style.display = 'none'; }
    function closeCartToSearch() { closeModal(); document.getElementById('search').focus(); }
    function undo() { if(lastDel) { cart[lastDel.pzn] = 1; lastDel = null; localStorage.setItem('de_cart', JSON.stringify(cart)); updateBar(); render(); renderCartItems(); renderPreview(); } }
    function clearSearch() { document.getElementById('search').value = ''; handleInput(); }
    
    init();

// –§–£–ù–ö–¶–ò–Ø –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–Ø –ó–ê–ö–ê–ó–ê –ü–û –°–°–´–õ–ö–ï
    function restoreOrderFromUrl() {
        // 1. –ß–∏—Ç–∞–µ–º —Ö—ç—à –∏–∑ –∞–¥—Ä–µ—Å–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ (–≤—Å—ë –ø–æ—Å–ª–µ #order=)
        const hash = window.location.hash;
        if (!hash || !hash.startsWith('#order=')) return;

        try {
            const orderString = hash.replace('#order=', '');
            const items = orderString.split('-'); // –†–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ –ø–∞—Ä—ã —Ç–æ–≤–∞—Ä*–∫–æ–ª-–≤–æ
            let addedCount = 0;
            let newCart = {}; // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –∫–æ—Ä–∑–∏–Ω—É (–∏–ª–∏ cart = {}, –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—É—é)

            items.forEach(itemStr => {
                const parts = itemStr.split('*');
                if (parts.length === 2) {
                    const pzn = parts[0];
                    const qty = parseInt(parts[1], 10);

                    // –í–ê–ñ–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Ç–∞–∫–æ–π —Ç–æ–≤–∞—Ä –≤ —Ç–µ–∫—É—â–µ–π –±–∞–∑–µ
                    const exists = db.some(r => r.PZN === pzn);

                    if (exists && !isNaN(qty) && qty > 0) {
                        newCart[pzn] = qty;
                        addedCount++;
                    }
                }
            });

            if (addedCount > 0) {
                // –ï—Å–ª–∏ –Ω–∞—à–ª–∏ —Ç–æ–≤–∞—Ä—ã ‚Äî –ø—Ä–∏–º–µ–Ω—è–µ–º
                // –ú–æ–∂–Ω–æ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å —Å–æ —Å—Ç–∞—Ä–æ–π –∫–æ—Ä–∑–∏–Ω–æ–π: cart = { ...cart, ...newCart };
                // –ù–æ –¥–ª—è "–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–∫–∞–∑" –ª–æ–≥–∏—á–Ω–µ–µ –∑–∞–º–µ–Ω–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É –ø–æ–ª–Ω–æ—Å—Ç—å—é:
                if (confirm(`–ó–∞–≥—Ä—É–∑–∏—Ç—å –∑–∞–∫–∞–∑ –∏–∑ —Å—Å—ã–ª–∫–∏ (${addedCount} –ø–æ–∑.)? –¢–µ–∫—É—â–∞—è –∫–æ—Ä–∑–∏–Ω–∞ –±—É–¥–µ—Ç –∑–∞–º–µ–Ω–µ–Ω–∞.`)) {
                     cart = newCart;
                     localStorage.setItem('de_cart', JSON.stringify(cart));
                     
                     updateBar();
                     render();
                     renderPreview();
                     
                     // –°—Ä–∞–∑—É –æ—Ç–∫—Ä—ã–≤–∞–µ–º –∫–æ—Ä–∑–∏–Ω—É, —á—Ç–æ–±—ã –∫–ª–∏–µ–Ω—Ç –≤–∏–¥–µ–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                     openCart();
                     
                     // –û—á–∏—â–∞–µ–º –∞–¥—Ä–µ—Å–Ω—É—é —Å—Ç—Ä–æ–∫—É, —á—Ç–æ–±—ã –ø—Ä–∏ F5 –Ω–µ —Å–ø—Ä–∞—à–∏–≤–∞–ª —Å–Ω–æ–≤–∞
                     history.replaceState(null, null, ' ');
                }
            }

        } catch (e) {
            console.error("–û—à–∏–±–∫–∞ —Ä–∞–∑–±–æ—Ä–∞ —Å—Å—ã–ª–∫–∏ –∑–∞–∫–∞–∑–∞", e);
        }
    }

</script>
</body>
</html>