<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Google Sheets Connection Test</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #222; color: #0f0; }
        .log { margin-bottom: 10px; border-bottom: 1px solid #444; padding-bottom: 5px; }
        .error { color: #f55; }
        .success { color: #5f5; font-weight: bold; }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
</head>
<body>
    <h2>üì° –¢–ï–°–¢ –°–í–Ø–ó–ò –° GOOGLE SHEETS</h2>
    <div id="console"></div>

    <script>
        // –í–∞—à–∞ –ø—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ç–∞–±–ª–∏—Ü—É (Publish to Web)
        const GOOGLE_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTh9jBKA_RFbB03wt7VljCrZqxM9wBq9aGadw1uHCD4PQ5z5K3YoiF1bkxabc1kzPtP6tA6FLOxOB6b/pub?gid=185046132&single=true&output=csv';

        function log(msg, type = '') {
            const div = document.getElementById('console');
            div.innerHTML += `<div class="log ${type}">${msg}</div>`;
        }

        log("1. –ù–∞—á–∏–Ω–∞–µ–º –ø–æ–ø—ã—Ç–∫—É —Å–∫–∞—á–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –Ω–∞–ø—Ä—è–º—É—é —Å Google...");
        
        Papa.parse(GOOGLE_URL, {
            download: true,
            header: true,
            skipEmptyLines: true,
            complete: (results) => {
                console.log(results);
                if (results.data && results.data.length > 0) {
                    const firstRow = results.data[0];
                    const rate = firstRow['Current_Rate']; // –ò–º—è –∫–æ–ª–æ–Ω–∫–∏ –∏–∑ –≤–∞—à–µ–≥–æ —Ñ–∞–π–ª–∞
                    
                    log(`2. ‚úÖ –£–°–ü–ï–•! –§–∞–π–ª —Å–∫–∞—á–∞–Ω.`, 'success');
                    log(`3. –ù–∞–π–¥–µ–Ω–æ —Å—Ç—Ä–æ–∫: ${results.data.length}`);
                    log(`4. üí∞ –ö–£–†–° –í –Ø–ß–ï–ô–ö–ï Current_Rate: <b>${rate}</b>`, 'success');
                    
                    if (rate && rate.length > 6) {
                         log(`‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ: –ø–æ—Ö–æ–∂–µ, —ç—Ç–æ –Ω–µ —á–∏—Å–ª–æ, –∞ –æ—à–∏–±–∫–∞ —Ñ–æ—Ä–º—É–ª—ã? –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å.`);
                    }
                } else {
                    log("2. ‚ö†Ô∏è –§–∞–π–ª —Å–∫–∞—á–∞–Ω, –Ω–æ –æ–Ω –ø—É—Å—Ç–æ–π!", 'error');
                }
            },
            error: (err) => {
                console.error(err);
                log(`2. ‚ùå –û–®–ò–ë–ö–ê –î–û–°–¢–£–ü–ê (CORS –∏–ª–∏ –°–µ—Ç—å):`, 'error');
                log(`${err.message}`, 'error');
                log(`–í—ã–≤–æ–¥: Google –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø. –ù—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å db.csv + –≤–Ω–µ—à–Ω–∏–π API –¥–ª—è –∫—É—Ä—Å–∞.`);
            }
        });
    </script>
</body>
</html>